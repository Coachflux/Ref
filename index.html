<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Referral Mining App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f0f0f3;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 400px;
      margin: auto;
      padding: 20px;
    }
    input, button {
      width: 90%;
      padding: 10px;
      margin: 8px 0;
      border: none;
      border-radius: 8px;
      box-shadow: inset 2px 2px 5px #ccc, inset -2px -2px 5px #fff;
    }
    button {
      background: #007bff;
      color: white;
      cursor: pointer;
      box-shadow: 2px 2px 5px #ccc, -2px -2px 5px #fff;
    }
    button:hover {
      background: #0056b3;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin-top: 15px;
      box-shadow: 4px 4px 10px #ccc, -4px -4px 10px #fff;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Signup -->
    <div id="signupPage" class="card">
      <h2>Sign Up</h2>
      <input type="text" id="username" placeholder="Username">
      <input type="password" id="password" placeholder="Password">
      <input type="text" id="inviterCode" placeholder="Referral Code (Optional)">
      <button onclick="registerUser()">Sign Up</button>
    </div>

    <!-- Dashboard -->
    <div id="dashboardPage" class="card" style="display:none;">
      <h2>Welcome, <span id="displayUsername"></span></h2>
      <p>Balance: $<span id="balance">0.00000</span></p>
      <p>Referral Code: <span id="referralCode"></span></p>
      <p>Referrals: <span id="referralCount">0</span></p>
      <p>Referral Profit: $<span id="referralProfit">0</span></p>
      <button id="mineBtn" onclick="toggleMining()">Start Mining</button>
    </div>
  </div>

  <script>
    let miningInterval = null;
    const miningRate = 0.00002; // per second

    // Generate referral code
    function generateReferralCode(username) {
      return btoa(username).substring(0, 6).toUpperCase();
    }

    // Register User
    function registerUser() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const inviterCode = document.getElementById('inviterCode').value.trim();

      if (!username || !password) return alert("Fill all fields.");
      if (localStorage.getItem(`user_${username}`)) return alert("Username already exists.");

      const user = {
        username,
        password,
        referralCode: generateReferralCode(username),
        invited: 0,
        referralProfit: 0,
        balance: 0
      };

      // Referral bonus
      if (inviterCode) {
        Object.keys(localStorage).forEach(key => {
          if (key.startsWith('user_')) {
            let inviter = JSON.parse(localStorage.getItem(key));
            if (inviter.referralCode === inviterCode && inviter.username !== username) {
              // Update inviter
              inviter.invited += 1;
              inviter.referralProfit += 0.3;
              inviter.balance += 0.3;
              localStorage.setItem(key, JSON.stringify(inviter));
              localStorage.setItem('baseBalance_' + inviter.username, inviter.balance);

              // Update invitee
              user.balance = 0.3;
            }
          }
        });
      }

      // Save user
      localStorage.setItem(`user_${username}`, JSON.stringify(user));
      localStorage.setItem('currentUser', username);
      localStorage.setItem('balance', user.balance);
      localStorage.setItem('baseBalance_' + username, user.balance);

      showDashboard();
    }

    // Show dashboard
    function showDashboard() {
      const username = localStorage.getItem('currentUser');
      if (!username) return;

      const user = JSON.parse(localStorage.getItem(`user_${username}`));
      document.getElementById('displayUsername').innerText = user.username;
      document.getElementById('balance').innerText = parseFloat(user.balance).toFixed(5);
      document.getElementById('referralCode').innerText = user.referralCode;
      document.getElementById('referralCount').innerText = user.invited;
      document.getElementById('referralProfit').innerText = user.referralProfit.toFixed(2);

      document.getElementById('signupPage').style.display = "none";
      document.getElementById('dashboardPage').style.display = "block";

      // Auto-resume mining if active
      resumeMining();
    }

    // Start mining
    function startMining() {
      const username = localStorage.getItem('currentUser');
      if (!username) return;

      let baseBalance = parseFloat(localStorage.getItem('baseBalance_' + username)) || 0;
      let startTime = Date.now();

      localStorage.setItem('miningActive_' + username, true);
      localStorage.setItem('miningStart_' + username, startTime);
      localStorage.setItem('baseBalance_' + username, baseBalance);

      document.getElementById('mineBtn').innerText = "Stop Mining";

      miningInterval = setInterval(() => {
        const elapsed = (Date.now() - startTime) / 1000;
        let newBalance = baseBalance + (elapsed * miningRate);
        updateBalance(username, newBalance);
      }, 1000);
    }

    // Stop mining
    function stopMining() {
      const username = localStorage.getItem('currentUser');
      if (!username) return;

      clearInterval(miningInterval);
      miningInterval = null;

      let finalBalance = parseFloat(document.getElementById('balance').innerText);
      localStorage.setItem('baseBalance_' + username, finalBalance);
      localStorage.setItem('miningActive_' + username, false);

      document.getElementById('mineBtn').innerText = "Start Mining";
    }

    // Toggle mining
    function toggleMining() {
      const username = localStorage.getItem('currentUser');
      if (!username) return;
      const isMining = localStorage.getItem('miningActive_' + username) === "true";

      if (isMining) {
        stopMining();
      } else {
        startMining();
      }
    }

    // Resume mining after reload
    function resumeMining() {
      const username = localStorage.getItem('currentUser');
      if (!username) return;

      const isMining = localStorage.getItem('miningActive_' + username) === "true";
      if (!isMining) return;

      let baseBalance = parseFloat(localStorage.getItem('baseBalance_' + username)) || 0;
      let startTime = parseInt(localStorage.getItem('miningStart_' + username)) || Date.now();

      document.getElementById('mineBtn').innerText = "Stop Mining";

      miningInterval = setInterval(() => {
        const elapsed = (Date.now() - startTime) / 1000;
        let newBalance = baseBalance + (elapsed * miningRate);
        updateBalance(username, newBalance);
      }, 1000);
    }

    // Update balance
    function updateBalance(username, newBalance) {
      const user = JSON.parse(localStorage.getItem(`user_${username}`));
      user.balance = newBalance;
      localStorage.setItem(`user_${username}`, JSON.stringify(user));
      localStorage.setItem('balance', newBalance);
      document.getElementById('balance').innerText = newBalance.toFixed(5);
    }

    // Auto login if user already exists
    window.onload = function() {
      if (localStorage.getItem('currentUser')) {
        showDashboard();
      }
    }
  </script>
</body>
</html>
